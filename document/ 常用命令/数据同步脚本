1:创建dblink
create public database link emslink connect to ems identified by ems
　　 using '(DESCRIPTION =
(ADDRESS_LIST =
(ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
)
(CONNECT_DATA =
(SERVICE_NAME =ems)
)
)';

2:仓库数据同步
在执行同步前，必须先删除物化视图和物化视图的日志表，这样才不会和dblink冲突
日志表手工进行删除 
DROP MATERIALIZED VIEW T_ORG_BASE;
DROP MATERIALIZED VIEW LOG ON t_org;
DROP MATERIALIZED VIEW LOG ON t_org_org;
--建立仓库文件夹专门存放仓库的数据
INSERT INTO "EMSNEW"."T_ORG" (ID, NAME, ORGTYPE, SORT, STATE) VALUES ('storegroup', '仓库组', 'department', '0', 'valid');
INSERT INTO "EMSNEW"."T_ORG_ORG" (DIM, PARENT_ID, CHILD_ID) VALUES ('base', 'root', 'storegroup');
INSERT INTO "EMSNEW"."T_ORG" (ID, NAME, ORGTYPE, SORT, STATE) VALUES ('workunitgroup', '作业单位组', 'department', '0', 'valid');
INSERT INTO "EMSNEW"."T_ORG_ORG" (DIM, PARENT_ID, CHILD_ID) VALUES ('base', 'root', 'workunitgroup');

--插入t_org
insert into emsnew.t_org(id,code,name,name_short,orgtype,sort,state) 
select id,null,name,null,'store',0,'valid' from ems_store@emslink;
insert into t_org(id,code,name,name_short,orgtype,sort,state) 
select id,null,name,null,'workunit',0,'valid' from ems_workunit@emslink;
--插入t_org_org
insert into emsnew.t_org_org(dim,parent_id,child_id)
select 'base','storegroup',id from ems_store@emslink;
insert into emsnew.t_org_org(dim,parent_id,child_id)
select 'base','workunitgroup',id from ems_workunit@emslink;

--report_code重新生成功能
执行http://localhost:8085/org/initReportCode.do
--为仓库和作业单位添加职位
insert into t_position(id,name,org_id,positionType_id) 
select sys_guid(),'仓管'，id,'employee' from ems_store@emslink;
insert into t_position(id,name,org_id,positionType_id) 
select sys_guid(),'小组成员'，id,'workunitgroup' from ems_workunit@emslink;
--把仓库和作业单位的人员导过来

//--------------------------------===========================================================
--同步用户数据
insert into t_user(id,loginname,name,pwd,cannotdel,phone,state)
select id,username,name,password,0,phone,decode(status,'Y','valid','invalid') from sys_user@emslink
where username!='admin' and name is NOT NULL

--把作业单位的账号密码提取出来，作为用户
insert into t_user(id,loginname,name,pwd,cannotdel,phone,state，temp_workunit)
select sys_guid(),loginname,name,password,0,null,'valid',id from ems_workunit@emslink
--同时插入到作业单位组织单元下面的职位中
insert into t_position_org_user(user_id,position_id,org_id)
select b.id,a.id,a.org_id from t_position a,t_user b
where a.org_id=b.temp_workunit and a.positiontype_id='workunitgroup'


--菜单数据同步
--插入菜单数据和界面元素
insert into t_menu(id,code,menutype,name,parent_id,url,leaf)
select id,null,'menu',text,parentid,link,decode(leaf,'Y',1,0) from sys_navigation@emslink
where id!='ba44722c-adb9-4136-b460-12ef480419c9' or parentid!='ba44722c-adb9-4136-b460-12ef480419c9'
union all
select id,code,'element',text,navigation_id,null,1 from sys_uielement@emslink

--更新leaf，如果有子元素，leaf就改为0
update t_menu a set leaf=(select decode(count(*),0,1,0) from t_menu b where a.id=b.parent_id)


--角色数据同步
insert into t_role(id,name,roletype)
select id,text,'role' from sys_funrole@emslink

--角色可访问的菜单数据同步
--排除系统管理的菜单数据还有是排除错误的数据
insert into t_role_menu(role_id,menu_id)
select funrole_id,navigation_id from sys_navigation_funrole@emslink
where navigation_id!='ba44722c-adb9-4136-b460-12ef480419c9' 
    and navigation_id not in (select id from sys_navigation@emslink where parentid='ba44722c-adb9-4136-b460-12ef480419c9')
    and navigation_id  in (select id from sys_navigation@emslink)
union all
select funrole_id,uielement_id from sys_uielement_funrole@emslink

--同时插入已有菜单的父元素，因为现在是整个菜单树都授权
insert into t_role_menu(role_id,menu_id)
select distinct funrole_id,b.parentid from sys_navigation_funrole@emslink a,sys_navigation@emslink b
where a.navigation_id=b.id and a.navigation_id!='ba44722c-adb9-4136-b460-12ef480419c9' 
    and a.navigation_id not in (select id from sys_navigation@emslink where parentid='ba44722c-adb9-4136-b460-12ef480419c9')
    and a.navigation_id  in (select id from sys_navigation@emslink)
    
--用户角色对照关系同步
insert into t_role_user(user_id,role_id)
select distinct user_id,funrole_id from sys_funrole_user@emslink where user_id!='admin'
and user_id  in (select id from t_user)
and funrole_id  in (select id from t_role)
